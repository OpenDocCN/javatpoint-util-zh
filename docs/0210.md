# Linux 守护进程

> 原文：<https://www.javatpoint.com/linux-daemon>

## 什么是守护进程？

守护程序是一种在类似 UNIX 的操作系统上运行的程序，它在后台不引人注目地执行，而不是由用户直接访问。它等待由特定条件或事件的出现来触发。

通常，类似 UNIX 的系统会执行许多守护程序，主要用于通过网络上的其他系统来满足服务请求、硬件活动以及响应其他程序。

可能将守护程序激活到活动中的条件或操作的示例可以是特定的日期或时间、所述时间间隔的过去、从特定通信线路接收到的 web 请求或电子邮件，以及特定目录中的文件。

不强制要求条件或操作的实施者知道守护进程正在监听。

然而，程序经常会实现一个动作，只是因为它们知道它会隐式地唤醒一个守护进程。

守护进程也称为后台进程。它是一个在后台执行的 UNIX 或 Linux 程序。几乎每个守护进程都包含以字母“d”结尾的名称。例如，SSH，它管理 SSH 远程访问的连接，或者管理 Apache 服务器的 httpd 守护程序。通常，Linux 会在启动时启动守护程序。

各种 shell 脚本保存在/etc/init.d 目录中。这些脚本用于启动和停止守护程序。

## Linux 进程

通常，守护进程被实例化为进程。这些进程是程序的运行或执行实例。进程由内核处理，内核是操作系统的核心，它分配所有特殊的进程标识号。

在 Linux 中，主要有以下三种常见的进程:

*   一批
*   相互作用的
*   守护进程

批处理是通过进程队列提交的，与命令行无关。如果系统使用率低，这些过程非常适合执行重复操作。

交互过程由用户在命令行上交互执行。

守护进程由一个系统来标识，就像那些父进程包含一个 PID 的进程一样。

它总是定义进程初始化。初始化过程是在 Linux 系统启动时开始的初始过程，它会一直存在于系统上，直到系统关闭。

init 可以采用任何类型的进程，其父进程在不等待子进程状态的情况下终止或死亡。

因此，启动守护进程的基本技术是划分或分叉两次或一次，并在子进程开始实现其一般功能时，使父进程终止。

## 守护进程的历史

一些守护程序由 System V 的 init 脚本发布。这些脚本或短程序可以在系统启动时自动执行。它们可能会在一定时间间隔内被复制，也可能会在整个会话期间继续存在。

现在，几个守护进程只在需要时由一个守护进程(xinetd)启动，而不是连续执行。xinetd 被称为 TCP/IP 超级服务器。

它在启动时开始，并且监听分配给配置文件中列出的那些进程的各种端口，即/etc/xinetd.conf 或/etc/inetd.conf。

手动地，一些守护程序也可以被启动，以便由应用和操作系统启动。所有守护进程在几个类似 UNIX 的操作系统(包括 Linux)中都有一个单独的脚本，使用它可以重新启动和终止。

这些脚本的管理是根据 runlevels 实现的。运行级别可以定义为系统的操作或配置状态，它只允许某些选定的进程可用。开始一个独特的运行级可以支持解决某些问题，包括纠正系统错误。

## 守护程序的要点

守护程序的一些重要要点解释如下:

*   daemon 这个词取自希腊方法论 daemon。这些超自然生物介于凡人和神之间，拥有独特的力量或知识。
*   1963 年，在 IBM 7094 的帮助下，术语守护进程最初被应用于开创性项目 MAC 的系统上下文中。
*   它的灵感来自麦克斯韦的热力学和物理学守护进程，这是一个抽象的代理，支持不同速度的排序分子，并在后台不知疲倦地工作。
*   此后，这个术语被用来描述不知疲倦地执行系统杂务的后台进程。
*   第一台守护计算机是一个自动创建磁带备份的程序。
*   这个术语被用于计算机。它是磁盘和执行监视器的简称。
*   各种称为服务守护进程的程序在微软视窗操作系统上运行。然而，守护进程这个词有时也适用于这些系统。

## 守护程序的实现

### 类似 Unix 的系统

类 Unix 系统的进程是一个守护进程，如果它的父进程死了，这个守护进程被指定为 init 进程(1 号进程)作为父进程，并且不包含严格意义上的控制终端。

然而，守护进程可以是任何后台进程，无论 init 进程是否是子进程。

当过程通过命令行或启动脚本(如 System Starter 脚本或 init 脚本)开始时，过程的基本技术在类似 UNIX 的系统上成为守护程序，包括:

*   选择性地通过环境删除不必要的变量。
*   通过退出和分叉作为后台任务运行。它允许守护进程的父进程(启动或外壳进程)接收退出通知并继续正常执行。
*   通过调用部分分离，通常由单独的操作 setsid()完成:
    *   通过 tty 控制进行分离。
    *   创建新会话并成为该会话的会话负责人。
    *   成为过程组的领导者。
*   如果守护程序希望确保它不会继承新的 tty 控件，它可能会退出并再次分叉。这意味着它不再是新会话中的任何会话领导者，并且不能继承任何 tty 控制。
*   将当前工作目录设置为根目录，这样进程就不会使用任何可能位于已装载文件系统上的目录。
*   将 umask 修改为 0，以允许操作系统的 create()、open()和其他调用，从而简化它们的权限屏蔽，并且不依赖于所有调用方 umask。
*   将标准流(stderr、stdout、stdin)的文件描述符 0、1 和 2 重定向到日志文件或/dev/null，并关闭通过父进程获取的所有其他描述符文件。

当进程由任何超级服务器守护程序(如 systemd、launchd 或 inetd)开始时，超级服务器将为该进程实现这些功能，但那些没有转换为在 systemd 下执行并被描述为多线程的旧式守护程序以及在 inetd 上分叉数据报服务器的守护程序除外。

### 微软磁盘操作系统

这个类似守护程序的程序作为终止和驻留(简称 TSR)软件在微软 DOS 平台中执行。

### windows 操作系统

被称为窗口服务的程序在微软视窗操作系统上实现这些守护程序的功能。它们作为进程执行，通常不与鼠标、键盘和监视器交互。它们可能会在引导时借助操作系统启动。

Windows 服务由控制面板(专用配置/控制程序)、PowerShell 脚本系统或网络停止和网络启动命令(服务控制管理器的服务控制器元素)手动停止、启动和配置。

然而，任何 windows 应用都可以实现守护进程的职责，而不仅仅是像服务一样，一些 Windows 守护进程包含作为正常进程执行的选项。

### 经典的苹果操作系统和苹果操作系统

在引导时加载的那些文件促进了各种可选服务和功能，这些文件在经典的苹果操作系统上重建操作系统。

这些被称为控制面板和系统扩展。标准苹果操作系统的后期版本用完全成熟的无脸后台应用扩大了这些功能。

这些应用是在后台执行的常规应用。这些仍然被指定为用户的常规系统扩展。

macOS 是一个 Unix 系统，它使用守护进程。macOS 使用服务术语来指定实现通过服务菜单选择的功能的软件，而不是像 windows 对守护程序那样使用该术语。

## 典型的守护程序功能

*   像 cron 一样执行预定的操作。
*   监控系统，如磁盘阵列或硬盘运行状况。
*   响应网络请求，打开网络端口(如端口 80)。

### 对于 shell 提示符，我们如何启动、重启或停止守护程序？

我们需要应用他们的服务命令，如下所示:

```
service daemon-name-here start
service daemon-name-here stop
service daemon-name-here restart

```

在下面的例子中，星星，重启和停止。

```
service httpd start
service httpd stop
service httpd restart

```

### 我们如何检查每个正在运行的守护进程的列表？

要检查每个已安装守护程序的状态，请键入:

```
service - -status-all

```

## 规划我们的守护进程

### 守护进程要做什么？

守护进程必须实现一件事，并且很好地实现它。这一件事情可能像处理多个域中的大量邮箱一样复杂，或者像调用 sendmail 将其发送给管理员并指定报告一样简单。

我们必须更好地了解守护进程在任何情况下必须做什么。它将与我们可能指定或不指定的一些其他守护程序进行交互。这也是另一个需要研究的问题。

### 互动

守护程序绝不能通过终端直接与用户进行任何通信。每一次通信都经过一些接口排序(我们可能需要也可能不需要指定)，这可能像 GUI+GTK 一样复杂，也可能像一个单独的集合一样简单。

### 守护进程的基本结构

Daemon 必须执行一些低级的家务，以便在启动时为真正的工作做好准备。它包括如下步骤:

*   分叉一个超级进程(父进程)
*   修改文件模式掩码(umask)
*   打开要写入的日志
*   制作一个特殊的会话标识(简称 SID)
*   将工作目录(当前目录)修改到安全的地方
*   关闭文件的分类描述符
*   输入原始守护程序代码

## 类似 Unix 和 Linux 系统的守护服务列表

*   **anacron:** 它在启动时运行延迟 cron 动作。
*   **amd:** 代表自动挂载守护进程。
*   **atd:** 它执行排队的作业，在工具上应用。
*   **apmd:** 代表高级电源管理守护进程。
*   **crond:** 它是一个任务调度器守护进程。
*   **autofs:** 它帮助自动装载器守护程序允许按需卸载和装载设备。
*   **dhcpd:** 代表动态主机配置协议。此外，它是一个互联网引导协议服务器。
*   **cupdd:**代表 CUPS 打印机守护进程。
*   **ftpd:** 代表 FTP 服务器守护进程。
*   **httpd:** 是一个 Web 服务器守护进程。
*   **门控:**可以路由替代 egpup 的守护进程，路由并管理多个路由协议。
*   **lpd:** 代表行式打印机守护程序。
*   **imapd:** 是 imap 服务器守护进程。
*   **inetd:** 代表互联网超级服务器守护进程。
*   **memchached:** 是内存中的分布式对象缓存守护进程。
*   **mysql:** 它是一个数据库服务器守护进程。
*   **挂载:**是一个挂载守护进程。
*   **nfsd:** 代表网络文件共享守护进程。
*   **命名为:**是一个 DNS 服务器守护进程。
*   **nflock:** 用于启动和停止 nfs 文件的锁定服务。
*   **ntpd:** 代表网络时间协议服务守护进程。
*   **nmbd:** 代表网络消息阻塞守护进程。
*   **postgresql:** 它是一个数据库服务器守护程序。
*   **后缀:**是邮件传输代理，用来替代 Sendmail。
*   **rpcbind:** 代表远程过程调用绑定守护进程。
*   **路由:**处理路由表。
*   **smbd:** 是一个 Samba 守护进程。
*   **sendmail:** 是邮件传输代理守护程序。
*   **smtpd:** 代表简单邮件传输协议守护程序。
*   **squid:** 是一个网页缓存代理服务器守护进程。
*   **snmpd:** 代表简单网络管理协议守护进程。
*   **syncd:** 可以让各种文件系统和系统内存保持同步。
*   **sshd:** 它是一个安全外壳服务器守护程序。
*   **syslogd:** 代表系统日志守护进程。
*   **远程登录:**它是一个远程登录服务器守护程序。
*   **tcpd:** 它有一个服务包装器，可以限制来自 hosts.deny 和 hosts.allow 对基于 inetd 的服务的授权。
*   **vsftpd:** 代表非常安全的 FTP 守护进程。
*   **webmin:** 是一个基于 web 的管理服务器守护进程。
*   **xntd:** 是网络时间服务器守护程序。
*   **xinetd:** 是一个增强的互联网超级服务器守护进程。

* * *