# Linux 中的 ssh 是什么？

> 原文:[https://www.javatpoint.com/what-is-sshd-in-linux](https://www.javatpoint.com/what-is-sshd-in-linux)

SSH 是 OpenSSH 的一个服务器进程。它在 SSH 协议的帮助下接收传入的连接，并作为该协议的服务器运行。它管理**加密、文件传输、隧道、终端连接、**和**用户认证。**

## 不同 sshd 流程的角色和启动

当系统重新启动时，ssh 的进程开始。通常，程序位于文件处，即/usr/sbin/sshd。它作为根执行。启动进程作为接收传入连接的主服务器运行。

该进程通常是带有进程标识(最低)的进程或执行时间最长的进程。此外，它是 sshd 的所有其他进程的父进程。以下命令可用于在 [Linux](https://www.javatpoint.com/linux-tutorial) 上显示进程树。很容易找到哪个是父进程:

```

ps axjf

```

![What is sshd in Linux](../Images/c7679e060b6a78e1beb6943e3241389c.png)

ssh 的各种其他进程是代表单个连接的子进程。为 SSH 的所有新会话建立了一个更新的进程。

*   当 SSH 服务器重新启动或升级时，只会重新启动主服务器。
*   服务器被开发，因此服务器提供现有连接的过程继续运行。
*   例如，当修改 Sambar 服务器配置时，它可以最大限度地减少对用户的中断。
*   通常，重启 SSH 服务器最简单的方法之一是应用服务 SSH 重启命令。
*   当远程升级几个配置时，我们应该小心，因为错误会阻止再次连接到服务器。

此外，通过为特定的命令、终端或用户终止服务器进程，可以终止单个进程。这可以在例如 kill -9 <processid>命令的帮助下完成。</processid>

也可以在类似的系统上执行多个主 ssh 进程。然而，非常不寻常的是，我们发现组织客户的多台服务器同时运行，配置也各不相同。

所有服务器都必须监听不同的端口，并且通常有不同的配置文件。

## sshd 配置文件

SSH 服务器包含一个配置文件，通常是***/etc/SSH/SSH _ config。*** 该配置文件定义了日志记录、文件位置、身份验证选项、加密选项和其他几个参数。

## 记录

SSH 服务器应用系统日志子系统进行登录。有几种方法可以配置系统日志和各种系统日志服务器。多家企业将系统日志信息收集到集中的 **SIEM** 系统(安全事件和事件管理系统的简称)。

在大多数系统上，系统日志子系统可以配置为默认将 SSH 相关数据记录到 ***/var/log/auth*** 文件下的文件中。/var/log/auth 文件通常是大多数 Debian 派生系统的默认日志文件。 ***/var/log/secure*** 文件通常是大多数红帽衍生系统的默认日志文件。

日志记录级别和系统日志功能都可以在服务器配置文件中配置。强烈建议将登录级别设置为 ***【详细】*** 。因此，SSH 访问的指纹被正确记录。

OpenSSH 的最新版本可能会自动记录它。然而，Linux 的几个发行版都有不同的版本，如果没有这种类型的设置，它们不会记录指纹。

## 日志文件

查看各种日志文件通常可以了解问题的原因。有意地，传送到客户端的消息是为了透露一点关于以身份登录的用户的信息。这是出于安全考虑。

**例如**，我们不希望攻击者测试目标系统上可用的用户帐户。换句话说，通常可以在日志文件中检测到更多关于身份验证失败的数据。

## 调试方式

系统管理员可以手动执行服务器附带的选项，即 ***-d*** ，以获取服务器的其他详细结果。通常，它是识别连接问题的最终手段。

身份验证失败的原因在输出中通常很明显。与普通服务器相比，可能需要在不同的端口上执行较新的服务器。

这是因为没有阻止与服务器的新连接。服务器将与***ssh-d-p 2222***一起运行，之后客户端将与 ssh***-p 2222【[【邮件保护】](/cdn-cgi/l/email-protection)】主机*** 连接。

## 命令行中的 ssh 选项

手动地，很少需要为 SSH 服务器提供命令选项。只有重新打包 SSH 或者制作新的嵌入式平台或者新的 Linux 发行版的用户才会这么做。OpenSSH 中存在以下选项:

1.  **-4:** 仅使用 IPv4 地址。它可以应用在域名系统提供 IPv4 地址的环境中；然而，路由并不适用于这些类型的选项。
2.  **-6:** 仅使用 **IPv6 地址**。它可以应用于测试，以确保 IPv6 的连通性正常工作。
3.  **-C connection_spec:** 此选项用于测试配置文件内部或与选项组合内部的特定 Match 块，即 ***-T*** 。connection_spec 可以定义为以逗号分隔的 ***<keyword>= <value></value></keyword>***对列表，其中可以是下列之一:addr、lport、laddr、host 或 user。组合并允许-C 的一个以上选项。
4.  **-c host_certificate_file:** 此选项为主机定义包含主机证书的文件路径。这个证书是 OpenSSH 的专有格式。
5.  **-D:** 它不会变成守护进程而脱离。通常，它是在使用 systemd 执行 sshd 时应用的。它允许在这样的平台中进行更容易的监控。
    如果不使用此选项，SSH 服务器将从终端分离并分叉，从而使自己成为后台守护进程的一个进程。
    直到最近，后者都是执行 SSH 服务器的传统形式。一些嵌入式系统仍将使用后者。
6.  **-d:** 启用调试模式。服务器不会分叉，它将在以后处理单个连接时退出。它可用于诊断用户身份验证和其他类型的问题。
    通常，它会提供有关问题的更多细节，然后将其设置为客户端。
7.  **-E log_file:** 它将日志附加到特定文件，而不是将其传输到系统日志。
8.  **-e:** Ut 将调试日志写入各种标准错误。它可以用来调试。
9.  **-f config_file** 定义服务器配置文件的路径。默认情况下使用/etc/ssh/ssh _ config 文件。
10.  **-g login_grace:** 它定义了用户在打开到 SSH 服务器的连接后应该以多快的速度进行身份验证。 ***120 秒*** 是默认值，但可以在服务器配置文件中修改。超时通过启动到服务器的未经身份验证的连接来限制在服务器上保留资源。
11.  **-i:** 使用 inetd 执行服务器时使用。但是，现在没人这么做了。
12.  **-h host_key_file:** 定义了一个读取主机密钥的文件。我们可以使用文件，即/***etc/ssh/ssh _ host _***作为默认值。所有算法只能定义一个主机密钥。
13.  **-k 超时:**这是一个过时的选项。该选项应用于 1 版 SSH。强烈反对其应用。
14.  **-o 选项:**它覆盖配置文件中描述的配置选项。在不同的端口上测试和运行多台服务器会很有帮助。
15.  **-p 端口:**定义服务器接收的端口。 ***22*** 为默认港口。该端口也可以在服务器配置文件中描述。
16.  **-q:** 它不会向系统日志传输任何内容。不建议。这种选项的实际用途之一是让各种攻击者通过后门隐藏登录信息。真的，这个选项不应该存在。
17.  **-T:**
    读取服务器配置文件，检查语法，退出。在重新启动服务器之前，检查配置文件是否正常是有帮助的。
    特别是远程更新配置时，检查配置文件是必不可少的。在这些类型的情况下，最好通过在新端口上执行第二个服务器来测试新配置，并且只有在成功登录后在测试服务器的帮助下重新启动主服务器。
    它可以与选项-C 结合，用于测试配置文件中的单个匹配块。
18.  **-t:** 检查配置文件和引用密钥的有效性。在远程重启服务器之前，检查选项可获得额外休息的建议。
19.  **-u len:** 这个选项只包含一个有用的目的:描述-u0 点状 IP 地址保存在 utmp 文件中的原因。
    当授权密钥上的 from =模式或身份验证技术不需要时，它还禁止 SSH 服务器查找 DNS。

* * *