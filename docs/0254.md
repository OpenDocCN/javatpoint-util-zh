# Linux 防火墙

> 原文:[https://www.javatpoint.com/linux-firewall](https://www.javatpoint.com/linux-firewall)

## Linux 防火墙简介

防火墙可以定义为一个网络安全系统，它根据规则的预定义集控制和过滤流量。它是互联网和设备之间的中介系统。

Linux 的[内核](https://www.javatpoint.com/latest-kernel-linux-version)包含一个子系统，即 ***Netfilter。*** 它用于决定或操纵通过或进入我们服务器的网络流量命运。 [Linux](https://www.javatpoint.com/linux-tutorial) 防火墙的所有最新解决方案都将该系统应用于一个被称为 ***【包过滤】的过程。***

内核的包过滤系统进程对于许多没有任何用户空间界面来管理它的管理员来说用处不大。iptables 的目标是:如果数据包到达我们的服务器，它将根据 iptables 通过用户空间提供给它的各种规则，被传递给 ***网络过滤子系统*** 进行拒绝、接受或处理。

因此，iptables 是我们处理防火墙的全部要求，如果我们知道它的话。然而，存在几个前端来简化任务。

#### 注意:如果我们已经了解防火墙的工作原理，并且只希望了解命令，那么我们可以跳过防火墙工作原理，转到教程的结尾。

下面提到的一些 ***要点*** 是我们需要了解的 ***Linux 防火墙:***

*   防火墙是一组规则。
*   当数据包移出或移入受保护的空间时，其内容(关于其目标、协议和计划使用的源的信息)将根据防火墙规则进行检查，以确定是否必须允许其通过。
*   此外，iptables 是 CLI 的另一个工具，用于管理任何 Linux 机器上的防火墙规则。
*   此外，Firewalld 是一个管理任何 Linux 机器上防火墙规则的工具。
*   Linux 防火墙也可以描述为一种设备，它检查网络流量(出站/入站连接)，并确定是将流量送出还是通过流量。
*   在这个时代，网络安全源于不同种类的 Linux 防火墙。
*   在传统的数据包过滤中，防火墙过滤处理过滤和路由数据包，否则 NGFWs 将与一些其他功能(OSI 层)一起工作。

## 防火墙！防火墙

firewalld 可以定义为一种保护机器免受外部有害流量影响的方式。它允许所有用户通过指定防火墙规则集来管理主机上的网络流量(传入)。这些规则可用于对流量进行分类，并允许或阻止流量通过。

*   ***防火墙*** 应用简化交通管理的 ***服务和区域*** 概念。
*   *是一组预定义的规则 ***。****
**   网络源和接口被分配到 ***区域。*T3】***   允许的流量取决于我们的计算机链接到的网络以及该网络的安全级别。*   *防火墙服务可以定义为一些预定义的规则，这些规则包含每个基本设置，以允许特定服务的流量以及它们在区域内使用的流量。***   服务使用多个*或 ***端口*** 进行网络通信。***   防火墙的 ***过滤通信*** 基于 ***端口。****   要允许任何服务的网络流量，其端口应该是 ***开放的。*T3】***   *防火墙可以阻止未明确设置为开放的端口上的所有流量。***   默认情况下，像*这样的几个区域允许每个流量。***   *防火墙可用于基于用户已经确定的在网络中的流量和接口上放置的 ***信任级别*** 将网络分成不同的 ***区域*** 。******

 **## Linux 防火墙的工作原理

大多数 Linux 发行版都附带了许多默认防火墙工具，可以用来配置它们。我们将使用 Linux 中给出的***【IPTables】***(默认工具)来创建防火墙。Iptables 用于在 Linux 内核中设置、检查和维护 IPv6 和 IPv4 表的包过滤规则。

***重要:*** 本文中的每个命令都需要 sudo 的特权。

### Iptables 工作

***网络流量*** 是由**数据包组成的。**数据被分成各种小块(称为 ***包*** )，通过网络传输，一起放回。具体来说， ***iptables*** 识别收到的数据包，并应用一组规则来决定我们可以对它们做什么。

Ipatables 是一个命令行界面应用程序，它允许管理员配置特定的规则，这些规则将强制 Linux 内核执行一个操作，如丢弃、修改或检查网络数据包。

在 Linux 设备或机器中，启用 iptables 将充当 ***路由器*** 或/和 ***网络防火墙。***

内核的不同程序和模块用于不同的协议，例如 IPv4 上的 IPtables 应用程序、arp 上的 ARP 表、IPv6 上的 ip6 表和以太网帧上的 ebtables。

后来，一个名为*的项目开发了可伸缩性和性能的 Nftables。这是一个包过滤过程的框架，其工作类似于 Iptables。*

 ****Iptables*** 用于根据以下内容过滤数据包:

1.  **表:**这些是可以加入相同操作的文件。一张桌子由各种 ***锁链组成。***
2.  **锁链:**锁链是规则的弦。如果收到任何数据包，Ipatales 会找到一个合适的表，然后从规则链中执行该表，直到找到匹配项。
3.  **规则:**规则是通知系统需要如何处理数据包的语句。它们可以阻止单个数据包类型，或者转发其他类型的数据包。传输数据包的结果被称为 ***目标。***
4.  **目标:**目标是确定需要如何处理数据包。它通常用于接受、拒绝或丢弃错误(这将错误传递回发送者)。

## 链

链是为特定任务描述的一组规则。

有三种类型的链可用于处理流量:

1.  **前进链**
2.  **输出链**
3.  **输入链**

**1。前向链:**来自网络(外部)并去往其他网络的流量需要从前向链流出。如果两个或多个系统相连，并且我们希望在它们之间传输数据，则可以使用它。

**2。输出链:**通过我们本地机器流向互联网的流量需要我们从这些输出链出去。

**3。输入链:**通过网络(内部)到达本地机器的流量将来自输入链。这意味着他们需要脱离输入链中已经固定的每一条规则。

## 桌子

默认情况下，Linux 防火墙的 iptables 包含四个表。我们会列出每四张桌子。

### 1.过滤器

这张桌子被广泛使用。它充当保镖，决定谁进出我们的网络。它包含一些默认链，如正向链、输入链和输出链。

### 2.网络地址转换

它包括网络地址转换(NAT)规则，用于将数据包路由到无法直接访问的网络。如果数据包的源或目的地必须修改，那么将使用 NAT 表。它包含下面提到的一些链:

*   **预路由:**用于服务器一收到数据包就分配数据包。
*   **输出:**这个链的作用类似于我们上面解释的输出链。
*   **后路由:**它允许在数据包离开输出链后对其进行更改。

### 3.损坏

此表用于调整数据包的 IP 报头属性。它包含了我们上面解释的每一条链:

*   **前进**
*   **输入**
*   **输出**
*   **后路由**
*   **预布线**

### 4.生的

此表用于通过连接跟踪免除数据包。它包含两条链:

*   **预布线**
*   **输出**

### 5.安全

这张桌子是可选的。一些 Linux 版本使用安全表来管理唯一的访问规则。它包含正向、输入和输出链。

## 目标

目标是数据包符合任何规则标准后会发生什么。许多目标(非终结)保持将各种数据包与链中的规则相匹配，即使数据包与规则相匹配。

数据包会立即被评估，并且不会与终止目标中的其他链匹配。

### 不同类型的策略

iptables 可以在流量上实现三种不同的操作:

1.  **接受**
2.  **拒绝**
3.  **下降**
4.  **返回**

**1。接受:**当流量通过指定链中的一些规则时，iptables 将接受流量。这意味着它开辟了许多途径，并允许用户访问规则和条例。

**2。拒绝:**该动作与丢弃动作相同。但是，它会向任何流量的发送方传输一条消息，说明数据传输失败。

当我们希望另一端了解端口不可用时，我们可以使用 ***【拒绝】*** 动作作为正常规则。

**3。丢弃:**当 iptables 无法通过指定链内的规则时，它可以阻止任何流量。意味着防火墙已经关闭。

#### 注意:我们需要记住这里的一个一般规则:-
在 iptables 中，我们设置的规则是通过最上面的规则向底部检查的。只要数据包通过任何顶级规则，就允许通过防火墙。较低的规则不被检查。因此，我们在制定规则时必须小心。

**4。RETURN:** 它将数据包传输回生产链，这样我们就可以将其与其他规则进行匹配。

## 在 Ubuntu 中配置和安装防火墙 iptables

默认情况下，iptables 安装在大多数 Linux 发行版上。我们可以使用以下命令来确保 iptable 在我们的系统上可用:

```

$ sudo apt-get install iptables

```

![Linux Firewall](../Images/81e314b35717dc101784c5e8a8012002.png)

iptables 中的语法和选项

iptables 的命令通常如下所示:

```

$ sudo iptables [option] CHAIN_rule [-j target]

```

以下是 iptables 的一些常用选项:

*   **- append，-A:** 用于向链的末端添加任何规则。
*   **-检查，-C:** 它寻找与一个链的要求相匹配的规则。
*   **-删除，-D:** 它从链中删除已定义的规则。
*   **-同花顺，-F:** 它从链中移除所有规则。
*   **- insert，-I:** 用于在指定位置向链中添加任意规则。
*   **- list，-L:** 此选项用于显示链中的每个规则。
*   **-新链，-N:** 它制造新链。
*   **- verbose，-V:** 如果使用此选项，将显示更多详细信息。
*   **- delete-chain，-X:** 它删除给定的链。

#### 注意:请确保我们使用了适当的选项，因为 iptables 区分大小写。

## iptables 的基本命令

### 1.列出 iptables 当前规则

我们可以使用以下命令列出 iptables 当前规则:

```

$ sudo iptables -L

```

![Linux Firewall](../Images/970a8e54f4602b6e35d03306647f2fb0.png)

正如我们所看到的，有三条链可用(前进、输入、输出)。此外，我们可以检查列标题。然而，它们不是原始规则。这是因为几乎所有的 Linux 都没有预定义的规则。

让我们讨论所有列的含义:

**目标:**

它指定了需要在数据包上执行的操作(接受、拒绝、丢弃)。

**波特:**

它指定了数据包的协议。

**来源:**

它定义了数据包的源地址。

**目的地:**

它指定数据包的目的地址。

### 2.明确的规则:

如果我们希望清空或清除所有现有规则，那么我们可以执行以下命令:

```

$ sudo iptables -F

```

![Linux Firewall](../Images/9f7025da31e93719913acbb0fbaec31b.png)

它将重置 iptables。

### 3.修改默认链策略

语法如下:

```

$ sudo iptables -P Chain_name Action_to_be_taken

```

在上面的截图中，所有链的默认策略是 ACCEPT。

**例如**

如果我们检查正向链，我们将检查 ***“链正向(政策接受)”*** 。这意味着我们的计算机允许流量转发到另一台计算机。

我们可以使用以下命令修改要丢弃的转发策略:

```

$ sudo iptables -P FORWARD DROP

```

![Linux Firewall](../Images/2e639e3c1f8570a99608686052554685.png)

它将阻止从我们的计算机转发的流量。这意味着没有其他计算机可以作为中介访问我们的计算机来传递数据。

## 创造我们的第一条规则

### 1.丢弃规则

现在，我们将开始构建防火墙的策略。首先，我们将研究一个输入链，在这个链中，流量(传入的)将被传递。

**语法:**

```

$ sudo iptables -A/ -I chain_name -s source_ip -j action_to_take

```

我们将举一个例子来理解这个主题:

假设我们希望阻止任何通过 192.168.1.3 IP 地址的流量。可以使用以下命令:

```

$ sudo iptables -A INPUT -s 192.168.1.3 -j DROP

```

![Linux Firewall](../Images/090292736b48535a752e7027b31ce81c.png)

这可能看起来很典型，但如果我们继续分析这些元素，它会有意义:

**-一次输入**

平面用于将规则附加到链的末端。该命令的这一部分定义了我们希望包含一个规则的 iptables，该规则指向 INPUT 链的末端。

**-我输入**

规则包含在该标志中的链的顶部。

**-s 192.168.1.3**

-s 标志用于指定数据包来源。它告诉 iptable 检查来自 192.168.1.3 源的数据包。

**-j DROP**

它描述了 iptable 必须如何处理数据包。该命令包括上述输入链的规则。它说，如果有一个 IP 地址为 192.168.1.3 的数据包到来，请丢弃该数据包，这意味着不允许该数据包到达系统。

运行该命令后，我们可以在以下命令的帮助下检查修改:

```

$ sudo iptables -L

```

![Linux Firewall](../Images/f246b80e42c372063a779b2f38982725.png)

### 2.接受规则

如果我们希望将规则添加到我们网络的特定端口，我们可以使用以下命令:

```

$ sudo iptables -A/ -I chain_name -s source_ip protocol_name -dport port_number Action_to_take

```

**在哪里，**

**-p 协议 _ 名称**

它用于匹配那些追求协议名称协议的数据包。

**-dpport port _ number**

只有当我们提供选项时才可用，即 ***-p protocol_name。*** 它定义检查许多去往 ***【端口号】*** 端口的数据包。

**例如**

让我们假设我们希望保持 SSH 端口对网络 192.168.1.3 开放，我们在上述条件下阻止了该端口。也就是说，我们只希望允许那些 IP 地址为 192.168.1.3 的数据包到达 22 端口。

我们该怎么办？

让我们尝试以下命令:

```

$ sudo iptables -A INPUT -s 192.168.1.3 -p tcp --dport 22 -j ACCEPT

```

![Linux Firewall](../Images/b412d4b79ad1204d5e392aad24e99cc3.png)

这个命令定义寻找那些来自 192.168.1.3 IP 地址、具有 TCP 协议的数据包，并希望向我们计算机的 22 端口提供一些东西。如果我们找到这种类型的包，接受它们。

正如我们之前解释的，在 iptables 中，我们设置的规则是从上到下检查的。每当数据包被处理为任何顶级规则时，都不会与任何低级规则一起被检查。

但是在我们的例子中，使用顶部规则检查了数据包。它定义了 iptable 应该丢弃通过 192.168.1.3 IP 地址的数据包。

因此，一旦数据包从允许数据包到达 22 端口的规则中被访问，它就不会进入即将到来的规则。所以失败了。

能做什么？

我们可以在链的顶部添加一个规则。我们要做的就是把选项-A 切换到选项-I。

这样做的命令如下:

```

$ sudo iptables -I INPUT -s 192.168.1.3 -p tcp --dport 22 -j ACCEPT

```

![Linux Firewall](../Images/81a50ccc866a863f2212e98a1f1d7894.png)

现在，我们将使用-L 选项检查 iptable 的配置。

因此，源自 192.168.1.3 IP 地址的那些数据包在到达 22 端口时会被初始检查。如果不是，则从链中的下一个规则执行。

否则，允许通过防火墙。

我们现在明白了接受和阻断交通。让我们来看看如何移除或删除规则。

### 3.通过 iptable 移除规则

**语法:**

```

$ sudo iptables -D INPUT 1

```

![Linux Firewall](../Images/8574d9668d1a3553951e7f1d2faab72b.png)

### 4.保存我们的配置

如果我们在一台不是服务器的电脑上做，这个部分是不必要的。但是，如果我们在服务器上实施任何防火墙，我们的服务器很有可能会损坏，我们可能会丢失所有数据。因此，我们最好保存我们的配置。

做这件事的方法有很多，但是我们用 iptables 找到的最有效的方法是-*包。我们可以从 Ubuntu 的默认存储库中下载这个包:*

 *```

$ sudo apt-get update
$ sudo apt-get install iptables-persistent

```

![Linux Firewall](../Images/25e775bfa05bac718e4a64d4378a50c9.png)

安装过程完成后，我们可以在以下命令的帮助下保存配置:

```

$ sudo service netfilter-persistent save 

```

![Linux Firewall](../Images/6742d6e9041ff8182dbc85b524f70c40.png)

* * *****